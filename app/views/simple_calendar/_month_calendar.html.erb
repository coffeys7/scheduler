<div class="simple-calendar">
  <div class="calendar-heading">
    <%= link_to calendar.url_for_previous_view, :class => 'btn-flat calendar-toggle' do %>
        <i class="fa fa-caret-left"></i>
    <% end %>
    <span class="calendar-title"><%= t('date.month_names')[start_date.month] %> <%= start_date.year %></span>
    <%= link_to calendar.url_for_next_view, :class => 'btn-flat calendar-toggle' do %>
        <i class="fa fa-caret-right"></i>
    <% end %>
  </div>

  <table class="table table-striped">
    <thead>
      <tr>
        <% date_range.slice(0, 7).each do |day| %>
          <th><%= t('date.day_names')[day.wday] %></th>
        <% end %>
      </tr>
    </thead>

    <tbody>
      <% date_range.each_slice(7) do |week| %>
        <tr>
          <% week.each do |day| %>
            <%= content_tag :td, class: calendar.td_classes_for(day) do %>
              <% if defined?(Haml) && respond_to?(:block_is_haml?) && block_is_haml?(block) %>
                <% capture_haml(day, sorted_events.fetch(day, []), &block) %>
              <% else %>
                <% block.call day, sorted_events.fetch(day, []) %>
              <% end %>
              <ul class="activities">
                <% current_user.activities_for_day(day).each do |activity| %>
                  <li class="activity">
                    <% time_range = (activity.start_time && activity.end_time) ? ("(#{ activity.start_time.strftime("%-I:%M%p") } - #{ activity.end_time.strftime("%-I:%M%p") })") : false %>
                    <a href="<%= "/activities/#{ activity.id }" %>" class="<%= activity.activity_type %> <%= 'completed' if activity.complete? %>"><%= activity.title %>
                      <% if time_range %>
                          <br><span class="time-range"><%= time_range %></span>
                      <% end %>
                    </a>
                  </li>
                <% end %>
              </ul>
            <% end %>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<script>
  $(document).on('turbolinks:load', function() {
    //
    // Calendar toggle
    //
    $('.calendar-toggle').click(function() {
      $('.calendar-heading').html('<div class="loader"><i class="fa fa-circle-o-notch"></i></div>');
    });
  });
</script>
